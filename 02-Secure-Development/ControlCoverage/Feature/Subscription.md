<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

</head><body>
<H2>SubscriptionCore</H2>
<table>
<colgroup><col/><col/><col/></colgroup>
<tr><th>Description & & Rationale</th><th>ControlSeverity</th><th>Automated</th></tr>
<tr><td><b>Minimize the number of admins/owners</b><br/>Each additional person in the Owner/Contributor role increases the attack surface for the entire subscription. The number of members in these roles should be kept to as low as possible.</td><td>Medium</td><td>Yes</td></tr>
<tr><td><b>Mandatory central accounts must be present on the subscription</b><br/>Certain central accounts are expected to be present in all subscriptions to support enterprise wide functions (e.g., for security scans, cost optimization, etc.). Certain other accounts may also be required depending on special functionality enabled in a subscription (e.g., for Express Route-network support/compliance checks). The script checks for presence of such 'mandatory' and 'scenario-specific' accounts.</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Deprecated/stale accounts must not be present on the subscription</b><br/>Further to the above RBAC check, some accounts were once deployed across subscriptions for some trial/pilot. These accounts should not be retained any more in any role. The script warns about presence of such 'deprecated' accounts as well.</td><td>Critical</td><td>Yes</td></tr>
<tr><td><b>Do not grant permissions to external accounts (i.e., accounts outside the native directory for the subscription)</b><br/>All access to subscriptions, resource groups or individual resources at Microsoft must be gated via Microsoft corporate AAD (tenant) identities (replicated across from the corporate AD forest). The script checks that non-AD accounts (such as xyz@hotmail.com, pqr@outlook.com, etc.) are not granted permission at any level within a subscription.</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Service accounts cannot support MFA and should not be used for subscription activity</b><br/>Service accounts are typically not multi-factor authentication capable. Quite often, sloppy use of service accounts by teams who own them (e.g., to login interactively on servers) exposes their credentials to attacks such as pass-the-hash, phishing, etc. As a result, using service accounts in any privileged role in a subscription exposes the subscription to credential-theft related risks. (In effect, the subscription becomes accessible after the single-factor protection is compromised…defeating the pervasive multi-factor authentication (MFA) requirement we aim to enforce.)</td><td>High</td><td>No</td></tr>
<tr><td><b>There should not be more than 2 classic administrators</b><br/>The v1 (ASM-based) version of Azure resource access model did not have much in terms of RBAC support. As a result, everyone who needed any access on a subscription or its resources had to be added to the Co-administrator role. These individuals are referred to as 'classic' administrators. In the v2 (ARM-based) model, this is not required at all and even the count of 2 classic admins currently permitted is for backward compatibility purposes. (Some Azure services are still migrating onto the ARM-based model so creating/operating on them needs 'classic' admin privilege.)</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Use of management certificates is not permitted.</b><br/>Just like classic admins above, management certificates were used in the v1 model for script/tool based automation on Azure subscriptions. These management certificates are highly risky because the hygiene around protection of the private key for these certificates tends to be lapse. These certificates have no place in the current ARM-based model and should be immediately cleaned up if found on a subscription. (VS-deployment certificates from v1 timeframe are a good example of this.)</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Azure Security Center (ASC) must be correctly configured on the subscription</b><br/>The Security Center feature in Azure helps with important central settings for the subscription such as configuring a security point of contact. It also supports key policy settings (e.g., is patching configured for VMs?, is threat detection enabled for SQL?, etc.) and alerts about resources which are not compliant to those policy settings. Correctly configuring ASC is critical as it gives a baseline layer of protection for the subscription and commonly used resource types.</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Pending Azure Security Center (ASC) alerts must be resolved</b><br/>Based on the policies that are enabled in the subscription, Azure Security Center raises alerts (which are typically indicative of resources that are not compliant with some baseline security protection). It is important that these alerts/actions are resolved promptly in order to eliminate the exposure to attacks.</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Pending Azure Security Center (ASC) tasks and recommendations must be resolved</b><br/>Similar to the ASC alerts above</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Service Principal Names (SPNs) should not be Owners or Contributors on the subscription</b><br/>Just like AD-based service accounts, SPNs have a single credential and most scenarios that use them cannot support multi-factor authentication. As a result, adding SPNs to a subscription in 'Owners' or 'Contributors' roles is risky.</td><td>Medium</td><td>Yes</td></tr>
<tr><td><b>Critical application resources should be protected using a resource lock</b><br/>A resource lock protects a resource from getting accidentally deleted. With proper RBAC configuration, it is possible to setup critical resources in a subscription in such a way that people can perform most operations on them but cannot delete them. These protective mechanisms can help ensure that important data is not lost by accidental/malicious deletion of such resources (and ensure that availability is not impacted).</td><td>Medium</td><td>Yes</td></tr>
<tr><td><b>ARM policies should be used to audit or deny certain activities in the subscription that can impact security</b><br/>The AzSDK subscription security setup configures a set of ARM policies which result in audit log entries upon actions that violate the policies. (For instance, an entry is generated if someone creates a v1 resource in a subscription.) The health check script checks for the presence of these policies are present in a subscription.(Note that ARM policies are specific to ARM operations on resources and different than ASC policies mentioned in the ASC check above. ASC policies are more general things such as 'enable auto-patchin', etc.)</td><td>Medium</td><td>Yes</td></tr>
<tr><td><b>Alerts must be configured for critical actions on subscription and resources</b><br/>The AzSDK subscription security setup configures Insights-based alerts for sensitive operations in the subscription. These use the Azure Monitor feature to generate email notifications when sensitive actions happen in a subscription (e.g., if someone adds a new person to the Owners group or if a new certificate is uploaded to a web site). The health check script verifies if all such alerts as defined in the AzSDK alert configuration have been configured on a subscription.(Note that the AzSDK supports setting up alerts via OMS as well. This is an alternate mechanism that may be used. In the OMS-based approach, Azure activity logs are piped into an OMS workspace and alerts are configured on the OMS side based on various conditions.)</td><td>High</td><td>Yes</td></tr>
<tr><td><b>Do not use custom-defined RBAC roles</b><br/>Custom RBAC role definitions are usually tricky to get right. A lot of threat modeling goes in when the product team works on and defines the different out-of-box security roles. As much as possible, teams should use the out-of-box roles for their RBAC needs. Using custom roles is treated as an exception and requires a rigorous review.</td><td>Medium</td><td>Yes</td></tr>
<tr><td><b>Do not use any classics resources on a subscription</b><br/>You should use new AzureRM (v2) resources as the ARM model provides stronger access control (RBAC) and auditing features.</td><td>High</td><td>Yes</td></tr>
</table>
</body></html>
